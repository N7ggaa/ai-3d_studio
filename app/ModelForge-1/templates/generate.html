{% extends "base.html" %}

{% block title %}Generate 3D Model - AI 3D Generator{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8 mx-auto">
        <div class="card">
            <div class="card-header">
                <h2 class="card-title mb-0">
                    <i data-feather="cpu" class="me-2"></i>
                    Generate 3D Model
                </h2>
            </div>
            <div class="card-body">
                <form method="POST" enctype="multipart/form-data" id="generationForm">
                    <!-- Text Prompt -->
                    <div class="mb-4">
                        <label for="prompt" class="form-label">
                            <i data-feather="type" class="me-2"></i>
                            Text Prompt
                            <span class="text-danger">*</span>
                        </label>
                        <textarea 
                            class="form-control" 
                            id="prompt" 
                            name="prompt" 
                            rows="4" 
                            placeholder="Describe the 3D model you want to generate (e.g., 'A futuristic spaceship with metallic hull and glowing engines')"
                            required
                        ></textarea>
                        <div class="form-text">
                            Be specific and descriptive for better results. Include details about shape, style, materials, and colors.
                        </div>
                    </div>

                    <!-- Reference Image Upload -->
                    <div class="mb-4">
                        <label for="reference_image" class="form-label">
                            <i data-feather="image" class="me-2"></i>
                            Reference Image (Optional)
                        </label>
                        <input 
                            type="file" 
                            class="form-control" 
                            id="reference_image" 
                            name="reference_image"
                            accept="image/*"
                        >
                        <div class="form-text">
                            Upload a reference image to guide the generation process. Supported formats: PNG, JPG, JPEG, GIF, BMP, WEBP.
                        </div>
                        
                        <!-- Image Preview -->
                        <div id="imagePreview" class="mt-3" style="display: none;">
                            <div class="border rounded p-3">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span class="fw-semibold">Preview:</span>
                                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="clearImage()">
                                        <i data-feather="x" class="me-1"></i>
                                        Remove
                                    </button>
                                </div>
                                <img id="previewImg" src="" alt="Preview" class="img-fluid" style="max-height: 200px;">
                            </div>
                        </div>
                    </div>

                    <!-- Advanced AI Generation Options -->
                    <div class="mb-4">
                        <h5 class="mb-3">
                            <i data-feather="zap" class="me-2"></i>
                            Advanced AI Generation
                        </h5>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="engine" class="form-label">Generation Engine</label>
                                <select class="form-select" id="engine" name="engine">
                                    <option value="hybrid">Hybrid (Recommended)</option>
                                    <option value="ai_enhanced">AI Enhanced</option>
                                    <option value="procedural">Procedural</option>
                                    <option value="texture_generated">Texture Generated</option>
                                </select>
                                <div class="form-text">Choose the generation method</div>
                            </div>
                            <div class="col-md-6">
                                <label for="material_style" class="form-label">Material Style</label>
                                <select class="form-select" id="material_style" name="material_style">
                                    <option value="realistic">Realistic</option>
                                    <option value="stylized">Stylized</option>
                                    <option value="low_poly">Low Poly</option>
                                    <option value="sci_fi">Sci-Fi</option>
                                    <option value="fantasy">Fantasy</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row g-3 mt-2">
                            <div class="col-md-6">
                                <label for="complexity" class="form-label">
                                    Complexity Level: <span id="complexityValue">7</span>
                                </label>
                                <input type="range" class="form-range" id="complexity" name="complexity" 
                                       min="1" max="10" value="7" oninput="updateComplexityValue()">
                                <div class="form-text">Higher complexity = more detailed models</div>
                            </div>
                            <div class="col-md-6">
                                <label for="detail_level" class="form-label">
                                    Detail Level: <span id="detailValue">8</span>
                                </label>
                                <input type="range" class="form-range" id="detail_level" name="detail_level" 
                                       min="1" max="10" value="8" oninput="updateDetailValue()">
                                <div class="form-text">Higher detail = finer surface details</div>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Options -->
                    <div class="mb-4">
                        <h5 class="mb-3">
                            <i data-feather="settings" class="me-2"></i>
                            Additional Options
                        </h5>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="lod_level" class="form-label">LOD Level</label>
                                <select class="form-select" id="lod_level" name="lod_level">
                                    <option value="medium">Medium (Default)</option>
                                    <option value="low">Low (Performance)</option>
                                    <option value="high">High (Quality)</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check mt-4">
                                    <input class="form-check-input" type="checkbox" id="fixForRoblox" name="fix_for_roblox" checked>
                                    <label class="form-check-label" for="fixForRoblox">
                                        Fix for Roblox
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row g-3 mt-2">
                            <div class="col-md-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="generateVariations" name="generate_variations">
                                    <label class="form-check-label" for="generateVariations">
                                        Generate variations
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="generateLod" name="generate_lod">
                                    <label class="form-check-label" for="generateLod">
                                        Generate LOD levels
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="fixForRoblox" name="fix_for_roblox" checked>
                                    <label class="form-check-label" for="fixForRoblox">
                                        Fix for Roblox
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row g-3 mt-2">
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="generateFbx" name="generate_fbx" checked>
                                    <label class="form-check-label" for="generateFbx">
                                        Generate .FBX file
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="generateBlend" name="generate_blend" checked>
                                    <label class="form-check-label" for="generateBlend">
                                        Generate .BLEND file
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary btn-lg" id="generateBtn">
                            <span id="generateBtnText">
                                <i data-feather="cpu" class="me-2"></i>
                                Generate 3D Model
                            </span>
                            <span id="generateBtnLoading" style="display: none;">
                                <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                                Generating...
                            </span>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Tips Card -->
        <div class="card mt-4">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i data-feather="help-circle" class="me-2"></i>
                    Tips for Better Results
                </h5>
            </div>
            <div class="card-body">
                <ul class="mb-0">
                    <li class="mb-2">
                        <strong>Be specific:</strong> Include details about shape, size, style, and materials
                    </li>
                    <li class="mb-2">
                        <strong>Use descriptive adjectives:</strong> "sleek", "weathered", "ornate", "minimalist"
                    </li>
                    <li class="mb-2">
                        <strong>Mention style:</strong> "low-poly", "realistic", "cartoon", "sci-fi", "medieval"
                    </li>
                    <li class="mb-2">
                        <strong>Include colors:</strong> Specify primary colors and materials
                    </li>
                    <li>
                        <strong>Reference images:</strong> Use clear, well-lit images showing the desired object from multiple angles
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('generationForm');
    const generateBtn = document.getElementById('generateBtn');
    const generateBtnText = document.getElementById('generateBtnText');
    const generateBtnLoading = document.getElementById('generateBtnLoading');
    const fileInput = document.getElementById('reference_image');
    const imagePreview = document.getElementById('imagePreview');
    const previewImg = document.getElementById('previewImg');

    // Handle form submission
    form.addEventListener('submit', function() {
        generateBtn.disabled = true;
        generateBtnText.style.display = 'none';
        generateBtnLoading.style.display = 'inline';
    });

    // Handle file input change
    fileInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                previewImg.src = e.target.result;
                imagePreview.style.display = 'block';
            };
            reader.readAsDataURL(file);
        } else {
            clearImage();
        }
    });

    // Clear image function
    window.clearImage = function() {
        fileInput.value = '';
        imagePreview.style.display = 'none';
        previewImg.src = '';
    };

    // Re-initialize feather icons for dynamically added content
    feather.replace();
});

// Slider value update functions
function updateComplexityValue() {
    const slider = document.getElementById('complexity');
    const value = document.getElementById('complexityValue');
    value.textContent = slider.value;
}

function updateDetailValue() {
    const slider = document.getElementById('detail_level');
    const value = document.getElementById('detailValue');
    value.textContent = slider.value;
}

// Initialize slider values on page load
document.addEventListener('DOMContentLoaded', function() {
    updateComplexityValue();
    updateDetailValue();
});
</script>
{% endblock %}
